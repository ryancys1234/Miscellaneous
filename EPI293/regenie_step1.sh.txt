#!/bin/bash
#SBATCH -c 4
#SBATCH -t 00-2:00
#SBATCH -p general
#SBATCH -o %x.%A_%a.out
#SBATCH -e %x.%A_%a.err

source ~/.bashrc
conda activate epi293

covar=${CWD}/hpfs_pheno_covar.txt
pheno=${CWD}/hpfs_pheno_covar.txt
phenoCol=predictScore # Replace this with the desired variable
bed=${GENETIC}/platform_${platform}/genotype_${platform_short}
step1_prefix=${CWD}/platform_${platform}/regenie/step1/hpfs_${phenoCol}_step1
mkdir -p ${CWD}/platform_${platform}/regenie/step1

plink2 --bfile ${bed} --keep ${pheno} --chr 1-22 --maf 0.05 --geno 0.05 --make-bed --out ${step1_prefix}_qced

# For binary traits, replace `--apply-rint` with `--bt --firth --approx`
regenie \
    --step 1 \
    --bed ${step1_prefix}_qced \
    --threads 4 \
    --phenoFile ${pheno} \
    --covarFile ${covar} \
    --phenoCol ${phenoCol} \
    --apply-rint \
    --covarCol ageyr,PC1,PC2,PC3,PC4,PC5,PC6,PC7,PC8,PC9,PC10 \
    --pThresh 0.01 \
    --bsize 1000 --force-step1 --lowmem \
    --out ${step1_prefix}